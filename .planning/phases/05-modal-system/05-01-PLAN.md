---
phase: 05-modal-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/stores/modalStore.js
  - src/stores/index.js
  - src/components/modals/Modal/Modal.jsx
  - src/components/modals/Modal/index.js
  - src/components/modals/index.js
  - src/layouts/AppLayout.jsx
autonomous: true

must_haves:
  truths:
    - "Modal store can track citation modal state (isOpen, callId)"
    - "Modal store can track confirmation modal state (isOpen, action, managerName, sources)"
    - "Base Modal component renders children in portal to document.body"
    - "Modal responds to ESC key and backdrop click"
    - "Toaster component is mounted in AppLayout"
  artifacts:
    - path: "src/stores/modalStore.js"
      provides: "Modal state management with open/close actions"
      exports: ["useModalStore"]
    - path: "src/components/modals/Modal/Modal.jsx"
      provides: "Base dialog wrapper using native <dialog> element"
      exports: ["Modal"]
    - path: "src/components/modals/index.js"
      provides: "Barrel export for modal components"
  key_links:
    - from: "src/components/modals/Modal/Modal.jsx"
      to: "document.body"
      via: "createPortal"
      pattern: "createPortal.*document\\.body"
    - from: "src/layouts/AppLayout.jsx"
      to: "sonner"
      via: "Toaster component"
      pattern: "import.*Toaster.*from.*sonner"
---

<objective>
Set up modal infrastructure: Zustand store for modal state, base Modal component using native dialog, and Sonner toast system.

Purpose: Establish the foundation for CitationModal and ConfirmationModal in subsequent plans.
Output: Working modal store, reusable Modal component, and toast capability in AppLayout.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-modal-system/05-RESEARCH.md
@src/stores/timeframeStore.js
@src/stores/index.js
@src/layouts/AppLayout.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install sonner and create modal store</name>
  <files>
    package.json
    src/stores/modalStore.js
    src/stores/index.js
  </files>
  <action>
    1. Install sonner: `npm install sonner`

    2. Create src/stores/modalStore.js with Zustand store:
       - citationModal state: { isOpen: false, callId: null }
       - openCitationModal(callId): sets isOpen true and callId
       - closeCitationModal(): resets to initial state
       - confirmationModal state: { isOpen: false, action: null, managerName: null, sources: [] }
       - openConfirmationModal(action, managerName, sources = []): sets all fields
       - closeConfirmationModal(): resets to initial state

    3. Update src/stores/index.js to export useModalStore

    Follow existing Zustand pattern from timeframeStore.js (simple create with set).
  </action>
  <verify>
    - `grep -l "sonner" package.json` returns package.json
    - `grep -l "useModalStore" src/stores/index.js` returns the file
  </verify>
  <done>
    Sonner installed, modalStore exports useModalStore with citationModal and confirmationModal state and actions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create base Modal component</name>
  <files>
    src/components/modals/Modal/Modal.jsx
    src/components/modals/Modal/index.js
    src/components/modals/index.js
  </files>
  <action>
    1. Create src/components/modals/Modal/Modal.jsx:
       - Accept props: isOpen, onClose, children, ariaLabel
       - Use useRef for dialog element
       - useEffect to sync React state with dialog.showModal()/close()
       - useEffect to handle 'cancel' event (ESC key) - call e.preventDefault() then onClose()
       - useEffect to handle click on dialog element itself for backdrop click (e.target === dialog)
       - Use createPortal to render to document.body
       - Style dialog with Tailwind: backdrop:bg-black/50, bg-white, rounded-lg, shadow-xl, max-w-lg, w-full, p-0

    2. Create src/components/modals/Modal/index.js with barrel export

    3. Create src/components/modals/index.js to export { Modal } from './Modal'

    Reference Pattern 1 from 05-RESEARCH.md for exact implementation.
  </action>
  <verify>
    - File exists: src/components/modals/Modal/Modal.jsx
    - `grep "createPortal" src/components/modals/Modal/Modal.jsx` shows portal usage
    - `grep "showModal" src/components/modals/Modal/Modal.jsx` shows native dialog method
  </verify>
  <done>
    Base Modal component exists with native dialog, portal rendering, ESC handling, and backdrop click.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Toaster to AppLayout</name>
  <files>src/layouts/AppLayout.jsx</files>
  <action>
    1. Import Toaster from 'sonner' at top of file
    2. Add <Toaster position="bottom-right" richColors /> inside the outermost div, after the main content area (just before closing </div>)

    This enables toast() calls from anywhere in the app.
  </action>
  <verify>
    - `grep "Toaster" src/layouts/AppLayout.jsx` shows import and component usage
    - `npm run build` succeeds
  </verify>
  <done>
    Toaster mounted in AppLayout, ready for toast notifications from ConfirmationModal.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run build` succeeds with no errors
2. `npm run dev` starts and app loads without console errors
3. Modal infrastructure is in place for Plan 02 and 03
</verification>

<success_criteria>
- Sonner installed and available for import
- modalStore exports useModalStore with citationModal and confirmationModal state
- Modal component uses native <dialog> with createPortal
- Toaster is mounted in AppLayout
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-modal-system/05-01-SUMMARY.md`
</output>
