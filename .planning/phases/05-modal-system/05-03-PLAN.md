---
phase: 05-modal-system
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/modals/ConfirmationModal/ConfirmationModal.jsx
  - src/components/modals/ConfirmationModal/index.js
  - src/components/modals/index.js
  - src/components/menus/ActionMenu/ActionMenu.jsx
  - src/layouts/AppLayout.jsx
autonomous: true

must_haves:
  truths:
    - "Clicking action in ActionMenu opens ConfirmationModal"
    - "ConfirmationModal shows action title and next 1:1 date"
    - "ConfirmationModal shows editable topic field"
    - "ConfirmationModal shows sources if provided"
    - "User can confirm action and sees success toast"
    - "Modal closes after confirmation or cancel"
  artifacts:
    - path: "src/components/modals/ConfirmationModal/ConfirmationModal.jsx"
      provides: "Action confirmation modal with form"
      exports: ["ConfirmationModal"]
    - path: "src/components/menus/ActionMenu/ActionMenu.jsx"
      provides: "Dropdown that opens confirmation modal via store"
  key_links:
    - from: "src/components/menus/ActionMenu/ActionMenu.jsx"
      to: "src/stores/modalStore.js"
      via: "useModalStore openConfirmationModal"
      pattern: "openConfirmationModal"
    - from: "src/components/modals/ConfirmationModal/ConfirmationModal.jsx"
      to: "sonner"
      via: "toast.success"
      pattern: "toast\\.success"
---

<objective>
Create ConfirmationModal and wire ActionMenu to open it, with success toast on confirm.

Purpose: Fulfills ACT-03 through ACT-06 - users can confirm actions with context and see success feedback.
Output: Working ConfirmationModal that opens from ActionMenu and shows toast on confirmation.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-modal-system/05-RESEARCH.md
@.planning/phases/05-modal-system/05-01-SUMMARY.md
@src/components/menus/ActionMenu/ActionMenu.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConfirmationModal component</name>
  <files>
    src/components/modals/ConfirmationModal/ConfirmationModal.jsx
    src/components/modals/ConfirmationModal/index.js
    src/components/modals/index.js
  </files>
  <action>
    1. Create src/components/modals/ConfirmationModal/ConfirmationModal.jsx:
       - Import useState, useEffect from 'react'
       - Import toast from 'sonner'
       - Import useModalStore from '@/stores'
       - Import Modal from '../Modal'

       Define action labels and default topics:
       ```
       const actionLabels = {
         add_1on1: 'Add to 1:1 Agenda',
         send_summary: 'Send Coaching Summary',
         recognize: 'Send Recognition',
         flag_hr: 'Flag for HR Review'
       };
       const defaultTopics = {
         add_1on1: 'Review coaching metrics',
         send_summary: 'Weekly coaching summary',
         recognize: 'Great coaching this week!',
         flag_hr: 'Coaching concern - review needed'
       };
       ```

       Component:
       - Subscribe to confirmationModal state: { isOpen, action, managerName, sources }
       - Subscribe to closeConfirmationModal action
       - Local state: topic (string), nextDate (static: 'Tuesday, Jan 28')
       - useEffect to reset topic when modal opens: setTopic(defaultTopics[action] || '')
       - handleConfirm: log action, call toast.success with message, call closeConfirmationModal
       - Return null if !isOpen
       - Render Modal with:
         - Title: actionLabels[action] for {managerName}
         - Next 1:1 field (read-only): display nextDate
         - Topic field (editable): input with value={topic}, onChange updates state
         - Sources section (conditional): if sources.length > 0, show as font-mono badges
         - Cancel button (text style) and Confirm button (bg-foreground text-white)

    2. Create src/components/modals/ConfirmationModal/index.js with barrel export

    3. Update src/components/modals/index.js to also export ConfirmationModal
  </action>
  <verify>
    - File exists: src/components/modals/ConfirmationModal/ConfirmationModal.jsx
    - `grep "toast.success" src/components/modals/ConfirmationModal/ConfirmationModal.jsx` shows toast integration
    - `grep "defaultTopics" src/components/modals/ConfirmationModal/ConfirmationModal.jsx` shows form defaults
  </verify>
  <done>
    ConfirmationModal displays action title, next 1:1 date, editable topic, sources, and triggers toast on confirm.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire ActionMenu to open confirmation modal</name>
  <files>src/components/menus/ActionMenu/ActionMenu.jsx</files>
  <action>
    1. Import useModalStore from '@/stores'
    2. Get openConfirmationModal action from store using selective subscription
    3. Update handleAction function:
       - Remove the alert() call
       - Call openConfirmationModal(action.id, managerName, []) instead
       - Keep the console.log for debugging
       - Keep the onAction callback if provided
       - Keep setIsOpen(false) to close dropdown

    4. Optionally accept a sources prop (default []) to pass citation IDs that informed the action:
       - Update function signature: ActionMenu({ managerName, onAction, sources = [] })
       - Pass sources to openConfirmationModal: openConfirmationModal(action.id, managerName, sources)
  </action>
  <verify>
    - `grep "openConfirmationModal" src/components/menus/ActionMenu/ActionMenu.jsx` shows store integration
    - `grep "alert(" src/components/menus/ActionMenu/ActionMenu.jsx` returns nothing (removed)
  </verify>
  <done>
    ActionMenu opens ConfirmationModal via store when any action is clicked, passing manager name and sources.
  </done>
</task>

<task type="auto">
  <name>Task 3: Mount ConfirmationModal in AppLayout</name>
  <files>src/layouts/AppLayout.jsx</files>
  <action>
    1. Update import to include ConfirmationModal: import { CitationModal, ConfirmationModal } from '@/components/modals'
    2. Add <ConfirmationModal /> alongside CitationModal, before the Toaster

    This makes the modal available app-wide, rendered via portal to document.body.
  </action>
  <verify>
    - `grep "ConfirmationModal" src/layouts/AppLayout.jsx` shows import and usage
    - `npm run build` succeeds
  </verify>
  <done>
    ConfirmationModal mounted in AppLayout, available throughout the app.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run build` succeeds with no errors
2. `npm run dev` and navigate to a manager detail page
3. Click Actions dropdown and select any action
4. Verify ConfirmationModal opens with correct action title
5. Verify next 1:1 date is shown
6. Verify topic field is editable with appropriate default
7. Click Confirm and verify success toast appears
8. Verify modal closes after confirmation
9. Click action again, then click Cancel
10. Verify modal closes without toast
</verification>

<success_criteria>
- Clicking any action in ActionMenu opens ConfirmationModal
- Modal shows action title and manager name
- Modal shows next 1:1 date (mocked)
- Modal shows editable topic field with smart default
- Modal shows sources if passed (empty for now)
- Confirm button triggers success toast and closes modal
- Cancel button closes modal without toast
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-modal-system/05-03-SUMMARY.md`
</output>
