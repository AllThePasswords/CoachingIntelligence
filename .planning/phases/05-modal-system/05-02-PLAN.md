---
phase: 05-modal-system
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/modals/CitationModal/CitationModal.jsx
  - src/components/modals/CitationModal/index.js
  - src/components/modals/index.js
  - src/components/display/Citation/Citation.jsx
  - src/layouts/AppLayout.jsx
autonomous: true

must_haves:
  truths:
    - "Clicking citation link opens CitationModal"
    - "CitationModal shows call ID, date, AE name, manager name"
    - "CitationModal shows pipeline stage and duration"
    - "CitationModal shows coaching activity checklist with check/x icons"
    - "CitationModal shows feedback text if available"
    - "CitationModal shows 'View Full Call' link (mocked)"
    - "Modal closes on ESC key or backdrop click"
  artifacts:
    - path: "src/components/modals/CitationModal/CitationModal.jsx"
      provides: "Citation details display modal"
      exports: ["CitationModal"]
    - path: "src/components/display/Citation/Citation.jsx"
      provides: "Clickable citation that opens modal via store"
  key_links:
    - from: "src/components/display/Citation/Citation.jsx"
      to: "src/stores/modalStore.js"
      via: "useModalStore openCitationModal"
      pattern: "openCitationModal"
    - from: "src/components/modals/CitationModal/CitationModal.jsx"
      to: "src/data/citations.js"
      via: "getCitationDetails"
      pattern: "getCitationDetails"
---

<objective>
Create CitationModal and wire Citation component to open it via modal store.

Purpose: Fulfills CITE-01 through CITE-06 - users can click any citation to view call details.
Output: Working CitationModal that opens when clicking any CALL-XXXX citation.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-modal-system/05-RESEARCH.md
@.planning/phases/05-modal-system/05-01-SUMMARY.md
@src/components/display/Citation/Citation.jsx
@src/data/citations.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CitationModal component</name>
  <files>
    src/components/modals/CitationModal/CitationModal.jsx
    src/components/modals/CitationModal/index.js
    src/components/modals/index.js
  </files>
  <action>
    1. Create src/components/modals/CitationModal/CitationModal.jsx:
       - Import useModalStore from '@/stores'
       - Import getCitationDetails from '@/data'
       - Import Modal from '../Modal'
       - Subscribe to citationModal state: { isOpen, callId }
       - Subscribe to closeCitationModal action
       - Get details via getCitationDetails(callId)
       - Return null if !isOpen or !details
       - Render Modal with:
         - Header: callId (font-mono text-xl) with X close button
         - Metadata grid (2 cols): Date, Duration, AE, Manager, Pipeline Stage (col-span-2)
         - Coaching Activity section: checkmark/x list for listened, attended, hasFeedback, hasComments, hasScorecard
         - Feedback section (conditional): blockquote with gray-50 bg and accent border-l-4
         - "View Full Call in Gong" link at bottom (onClick shows alert, mocked for v1)

    2. Create src/components/modals/CitationModal/index.js with barrel export

    3. Update src/components/modals/index.js to also export CitationModal

    Reference the detailed code example in 05-RESEARCH.md for exact structure.
    Use inline SVG for check (path: M5 13l4 4L19 7) and X (path: M6 18L18 6M6 6l12 12) icons.
  </action>
  <verify>
    - File exists: src/components/modals/CitationModal/CitationModal.jsx
    - `grep "getCitationDetails" src/components/modals/CitationModal/CitationModal.jsx` shows data fetch
    - `grep "coachingActivity" src/components/modals/CitationModal/CitationModal.jsx` shows checklist rendering
  </verify>
  <done>
    CitationModal displays all required call details: ID, date, AE, manager, stage, duration, coaching activity, feedback, and mocked "View Full Call" link.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Citation component to open modal</name>
  <files>src/components/display/Citation/Citation.jsx</files>
  <action>
    1. Import useModalStore from '@/stores'
    2. Get openCitationModal action from store using selective subscription
    3. Replace the onClick handler:
       - OLD: onClick={() => onClick?.(id)}
       - NEW: onClick={() => openCitationModal(id)}
    4. Remove the onClick prop from component signature (no longer needed)

    Keep the validation logic and error styling for invalid citations.
  </action>
  <verify>
    - `grep "openCitationModal" src/components/display/Citation/Citation.jsx` shows store integration
    - `grep "onClick?.(id)" src/components/display/Citation/Citation.jsx` returns nothing (removed)
  </verify>
  <done>
    Citation component opens CitationModal via store when clicked, no longer uses onClick prop.
  </done>
</task>

<task type="auto">
  <name>Task 3: Mount CitationModal in AppLayout</name>
  <files>src/layouts/AppLayout.jsx</files>
  <action>
    1. Import CitationModal from '@/components/modals'
    2. Add <CitationModal /> inside the outermost div, before the Toaster

    This makes the modal available app-wide, rendered via portal to document.body.
  </action>
  <verify>
    - `grep "CitationModal" src/layouts/AppLayout.jsx` shows import and usage
    - `npm run build` succeeds
  </verify>
  <done>
    CitationModal mounted in AppLayout, available throughout the app.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run build` succeeds with no errors
2. `npm run dev` and navigate to a manager detail page
3. Click any CALL-XXXX citation
4. Verify modal opens showing call ID, date, AE, manager, stage, duration
5. Verify coaching activity checklist shows checks and X marks
6. Verify feedback text displays if available
7. Verify "View Full Call" link shows alert when clicked
8. Verify ESC key closes modal
9. Verify clicking backdrop closes modal
</verification>

<success_criteria>
- Clicking any citation opens CitationModal with full call details
- Modal shows: call ID, date, AE name, manager name, pipeline stage, duration
- Modal shows coaching activity checklist with visual check/X indicators
- Modal shows feedback text when available
- Modal shows mocked "View Full Call" link
- Modal closes on ESC and backdrop click
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-modal-system/05-02-SUMMARY.md`
</output>
