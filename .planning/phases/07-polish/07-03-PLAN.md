---
phase: 07-polish
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - src/components/chat/MessageActions/MessageActions.jsx
  - src/components/chat/MessageActions/index.js
  - src/components/chat/index.js
  - src/components/chat/ChatMessage/ChatMessage.jsx
autonomous: true

must_haves:
  truths:
    - "Copy button appears on all assistant messages and copies to clipboard"
    - "Add to 1:1 button appears when message mentions a manager name"
    - "Clicking Add to 1:1 opens confirmation modal"
    - "Action buttons have visible focus states for keyboard navigation"
  artifacts:
    - path: "src/components/chat/MessageActions/MessageActions.jsx"
      provides: "Contextual action buttons for AI responses"
      exports: ["MessageActions"]
    - path: "src/components/chat/ChatMessage/ChatMessage.jsx"
      provides: "ChatMessage with MessageActions integrated"
      contains: "MessageActions"
  key_links:
    - from: "src/components/chat/MessageActions/MessageActions.jsx"
      to: "modalStore"
      via: "openConfirmationModal"
      pattern: "useModalStore.*openConfirmationModal"
---

<objective>
Create contextual action buttons for AI responses (ASK-07 requirement).

Purpose: Allow users to take actions (copy, add to 1:1) directly from AI responses.
Output: MessageActions component integrated into ChatMessage.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-polish/07-RESEARCH.md
@src/components/chat/ChatMessage/ChatMessage.jsx
@src/stores/modalStore.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MessageActions component</name>
  <files>src/components/chat/MessageActions/MessageActions.jsx, src/components/chat/MessageActions/index.js</files>
  <action>
Create src/components/chat/MessageActions/MessageActions.jsx:

```jsx
// MessageActions - Contextual action buttons based on AI response content (ASK-07)
import { useState } from 'react';
import { toast } from 'sonner';
import { useModalStore } from '@/stores';

// Manager names to detect for "Add to 1:1" action
const MANAGER_NAMES = ['Sarah Chen', 'Marcus Jones', 'Jennifer Walsh', 'David Park'];
const MANAGER_PATTERN = new RegExp(MANAGER_NAMES.map(n => n.replace(' ', '\\s+')).join('|'), 'i');

/**
 * Action buttons that appear based on message content
 * @param {Object} props
 * @param {string} props.content - Message content to analyze
 * @param {string} props.messageId - Unique message ID
 */
export function MessageActions({ content, messageId }) {
  const [copied, setCopied] = useState(false);
  const openConfirmationModal = useModalStore((s) => s.openConfirmationModal);

  // Detect actionable content
  const managerMatch = content.match(MANAGER_PATTERN);
  const hasManagerMention = !!managerMatch;
  const mentionedManager = managerMatch ? managerMatch[0] : null;

  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(content);
      setCopied(true);
      toast.success('Copied to clipboard');
      setTimeout(() => setCopied(false), 2000);
    } catch (err) {
      toast.error('Failed to copy');
    }
  };

  const handleAddTo1on1 = () => {
    // Open confirmation modal with the mentioned manager as context
    // API: openConfirmationModal(action, managerName, sources)
    openConfirmationModal('add_1on1', mentionedManager, []);
  };

  return (
    <div className="flex items-center gap-1 mt-2 pt-2 border-t border-gray-100">
      {/* Copy button - always visible */}
      <button
        onClick={handleCopy}
        className="flex items-center gap-1.5 px-2 py-1 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors focus-ring"
        aria-label="Copy response"
      >
        {copied ? (
          <svg className="w-3.5 h-3.5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
          </svg>
        ) : (
          <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
        )}
        <span>{copied ? 'Copied!' : 'Copy'}</span>
      </button>

      {/* Add to 1:1 - only when manager mentioned */}
      {hasManagerMention && (
        <button
          onClick={handleAddTo1on1}
          className="flex items-center gap-1.5 px-2 py-1 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors focus-ring"
          aria-label={`Add to 1:1 with ${mentionedManager}`}
        >
          <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <span>Add to 1:1</span>
        </button>
      )}
    </div>
  );
}
```

Create barrel export src/components/chat/MessageActions/index.js:
```js
export { MessageActions } from './MessageActions';
```
  </action>
  <verify>MessageActions renders Copy button; when content includes "Sarah Chen", Add to 1:1 button appears</verify>
  <done>MessageActions shows contextual buttons based on message content</done>
</task>

<task type="auto">
  <name>Task 2: Integrate MessageActions into ChatMessage</name>
  <files>src/components/chat/ChatMessage/ChatMessage.jsx, src/components/chat/index.js</files>
  <action>
Update src/components/chat/ChatMessage/ChatMessage.jsx to include MessageActions for assistant messages:

1. Add import at top:
```jsx
import { MessageActions } from '../MessageActions';
```

2. Add MessageActions after MessageContent, only for assistant messages (not during streaming):
```jsx
{message.role === 'assistant' && !isStreaming && (
  <MessageActions content={message.content} messageId={message.id} />
)}
```

Place this inside the message container div, after the MessageContent component.

Update src/components/chat/index.js to add MessageActions export:
```js
export { MessageActions } from './MessageActions';
```
  </action>
  <verify>Ask a question about Sarah Chen, observe Copy and Add to 1:1 buttons appear under AI response</verify>
  <done>Assistant messages show MessageActions with Copy button; messages mentioning managers show Add to 1:1</done>
</task>

<task type="auto">
  <name>Task 3: Add keyboard focus states to interactive elements</name>
  <files>src/components/chat/MessageActions/MessageActions.jsx, src/components/input/AskInput/AskInput.jsx</files>
  <action>
Verify focus-ring class is applied to all buttons in MessageActions (already done in Task 1).

Update src/components/input/AskInput/AskInput.jsx to add focus-ring class to the submit button and input:

1. Find the input element and add focus-ring class:
```jsx
className="... focus-ring ..."
```

2. Find the submit button and add focus-ring class:
```jsx
className="... focus-ring ..."
```

This ensures all interactive elements in the chat have visible focus indicators for keyboard navigation.
  </action>
  <verify>Import { ChatMessageSkeleton, ErrorFallback } from @/components/feedback works</verify>
  <done>All chat interactive elements have visible focus states when tabbed to</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Ask "How is Sarah Chen doing?" - response shows Copy + Add to 1:1 buttons
3. Ask "What's the team average?" - response shows only Copy button (no manager name)
4. Click Copy - toast appears "Copied to clipboard"
5. Click Add to 1:1 - confirmation modal opens with topic prefilled
6. Tab through chat UI - all buttons show focus rings
</verification>

<success_criteria>
- ASK-07 requirement complete: contextual action buttons appear based on AI response content
- Copy works via navigator.clipboard API with success feedback
- Add to 1:1 opens confirmation modal with context
- All buttons keyboard accessible with visible focus states
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish/07-03-SUMMARY.md`
</output>
