---
phase: 07-polish
plan: 04
type: execute
wave: 4
depends_on: ["07-03"]
files_modified:
  - src/layouts/AppLayout.jsx
  - src/pages/ManagerDetail/ManagerDetail.jsx
  - src/components/chat/ChatThread/ChatThread.jsx
autonomous: true

must_haves:
  truths:
    - "User sees friendly error message (not crash) when Claude API fails"
    - "User sees skeleton placeholder with shimmer while waiting for AI response to start"
    - "User sees visible focus ring when tabbing through buttons and inputs"
  artifacts:
    - path: "src/layouts/AppLayout.jsx"
      provides: "Error boundary around main content area"
      contains: "ErrorBoundary"
    - path: "src/pages/ManagerDetail/ManagerDetail.jsx"
      provides: "Error boundary around chat section"
      contains: "ErrorBoundary"
  key_links:
    - from: "src/layouts/AppLayout.jsx"
      to: "react-error-boundary"
      via: "import ErrorBoundary"
      pattern: "import.*ErrorBoundary.*from 'react-error-boundary'"
    - from: "src/components/chat/ChatThread/ChatThread.jsx"
      to: "src/components/feedback/Skeleton/Skeleton.jsx"
      via: "import ChatMessageSkeleton"
      pattern: "import.*ChatMessageSkeleton.*from '@/components/feedback'"
---

<objective>
Wire error boundaries around risky components and add final focus state polish.

Purpose: Ensure graceful degradation when Claude API fails and complete accessibility polish.
Output: Error boundaries in place, focus states applied to remaining interactive elements.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-polish/07-RESEARCH.md
@src/layouts/AppLayout.jsx
@src/pages/ManagerDetail/ManagerDetail.jsx
@src/components/chat/ChatThread/ChatThread.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add error boundary around chat section in ManagerDetail</name>
  <files>src/pages/ManagerDetail/ManagerDetail.jsx</files>
  <action>
Update src/pages/ManagerDetail/ManagerDetail.jsx to wrap the chat section with an error boundary:

1. Add imports at top:
```jsx
import { ErrorBoundary } from 'react-error-boundary';
import { ChatErrorFallback } from '@/components/feedback';
```

2. Find the section that contains ChatThread (the "Ask Anything About {manager.name}" section).

3. Wrap the ChatThread component with ErrorBoundary:
```jsx
<ErrorBoundary
  FallbackComponent={ChatErrorFallback}
  onReset={() => window.location.reload()}
  resetKeys={[managerId]}
>
  <ChatThread onSuggestionClick={sendMessage} />
</ErrorBoundary>
```

The resetKeys prop ensures the boundary resets when navigating to a different manager.
  </action>
  <verify>Intentionally break API call to see ChatErrorFallback render instead of crash</verify>
  <done>Chat section shows friendly error message when ChatThread throws, with retry option</done>
</task>

<task type="auto">
  <name>Task 2: Replace loading dots with ChatMessageSkeleton in ChatThread</name>
  <files>src/components/chat/ChatThread/ChatThread.jsx</files>
  <action>
Update src/components/chat/ChatThread/ChatThread.jsx to show skeleton while waiting for AI response:

1. Add import at top:
```jsx
import { ChatMessageSkeleton } from '@/components/feedback';
```

2. Replace the loading indicator section. Find:
```jsx
{/* Loading indicator */}
{status === 'loading' && (
  <div className="flex items-center gap-2 text-muted-foreground text-sm">
    <div className="flex gap-1">
      <span className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" />
      <span
        className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
        style={{ animationDelay: '0.1s' }}
      />
      <span
        className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
        style={{ animationDelay: '0.2s' }}
      />
    </div>
    <span>Analyzing your coaching data...</span>
  </div>
)}
```

Replace with:
```jsx
{/* Loading skeleton - shown while waiting for streaming to begin */}
{status === 'loading' && <ChatMessageSkeleton />}
```

The skeleton provides a visual placeholder that matches the incoming message layout, reducing layout shift when streaming begins.
  </action>
  <verify>Ask a question, observe skeleton with shimmer appears briefly before streaming text starts</verify>
  <done>ChatThread shows ChatMessageSkeleton with shimmer animation during loading state</done>
</task>

<task type="auto">
  <name>Task 3: Add focus-ring to remaining interactive elements</name>
  <files>src/components/cards/ManagerCard/ManagerCard.jsx, src/components/menus/ActionMenu/ActionMenu.jsx</files>
  <action>
Update focus states on key interactive elements:

1. In src/components/cards/ManagerCard/ManagerCard.jsx:
- Add focus-ring to the bell button:
```jsx
className="... focus-ring"
```
- Add focus-ring to the arrow button:
```jsx
className="... focus-ring"
```
- Make the card itself focusable with visible focus state:
```jsx
<div
  onClick={handleClick}
  tabIndex={0}
  onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') handleClick(); }}
  className="... focus:outline-none focus-visible:ring-2 focus-visible:ring-violet focus-visible:ring-offset-2"
  role="button"
  aria-label={`View details for ${manager.name}`}
>
```

2. In src/components/menus/ActionMenu/ActionMenu.jsx:
- Add focus-ring to the dropdown trigger button
- Add focus-ring to each dropdown menu item
  </action>
  <verify>Tab through dashboard and manager detail page, observe all buttons and cards show focus rings</verify>
  <done>All interactive elements have visible focus indicators for keyboard navigation</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Tab through entire app - all buttons, cards, and inputs show visible focus rings
3. Error boundary works: modify API key to invalid value, ask question, see ChatErrorFallback
4. Click retry in error fallback - page reloads to recover
5. Manager cards are keyboard navigable (Tab to focus, Enter to activate)
</verification>

<success_criteria>
- Error boundary catches chat errors and shows user-friendly fallback
- All interactive elements are keyboard navigable
- Focus states are visible on all focusable elements
- App passes basic keyboard accessibility test (Tab through all interactive elements)
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish/07-04-SUMMARY.md`
</output>
