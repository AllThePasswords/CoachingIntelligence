---
phase: 04-manager-detail
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - src/components/menus/ActionMenu/ActionMenu.jsx
  - src/components/menus/ActionMenu/index.js
  - src/components/menus/index.js
  - src/pages/ManagerDetail/ManagerDetail.jsx
autonomous: true

must_haves:
  truths:
    - "User sees Sources footer showing call listening, attendance, comments, scorecards, feedback events counts"
    - "User sees Actions dropdown in hero section"
    - "Actions menu shows: Add to 1:1, Send summary, Recognize, Flag for HR"
  artifacts:
    - path: "src/components/menus/ActionMenu/ActionMenu.jsx"
      provides: "Dropdown menu for manager actions"
      min_lines: 30
    - path: "src/components/menus/index.js"
      provides: "Barrel export for menus"
      exports: ["ActionMenu"]
  key_links:
    - from: "ManagerDetail.jsx"
      to: "manager.sources"
      via: "render sources footer"
      pattern: "sources\\.(call_listening|call_attendance|call_comments|scorecards|feedback_events)"
    - from: "ActionMenu.jsx"
      to: "onClick handlers"
      via: "action callbacks"
      pattern: "onClick.*console\\.log|alert"
---

<objective>
Build the Sources footer showing data provenance and the Actions dropdown menu for manager-specific actions.

Purpose: Sources provides transparency about where insights come from (call listening, attendance, comments, etc.). Actions give users quick access to common workflows (Add to 1:1, Send summary, Recognize, Flag for HR).

Output: ActionMenu component in menus/ directory, Sources footer, both integrated into ManagerDetail.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Manager sources data structure
@src/data/managers.js

# Research findings on ActionMenu pattern
@.planning/phases/04-manager-detail/04-RESEARCH.md

# Prior plan summaries
@.planning/phases/04-manager-detail/04-01-SUMMARY.md
@.planning/phases/04-manager-detail/04-02-SUMMARY.md
@.planning/phases/04-manager-detail/04-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ActionMenu Component</name>
  <files>
    src/components/menus/ActionMenu/ActionMenu.jsx
    src/components/menus/ActionMenu/index.js
    src/components/menus/index.js
  </files>
  <action>
Create ActionMenu dropdown in new menus/ directory:

1. **Create directory structure:**
   - src/components/menus/ActionMenu/ActionMenu.jsx
   - src/components/menus/ActionMenu/index.js
   - src/components/menus/index.js

2. **ActionMenu.jsx implementation:**
   ```jsx
   /**
    * ActionMenu - Dropdown menu for manager actions
    *
    * Pure React implementation with outside click handling
    * Actions are mocked for MVP (console.log)
    */
   import { useState, useRef, useEffect } from 'react';

   const defaultActions = [
     { id: 'add_1on1', label: 'Add to 1:1', icon: 'calendar' },
     { id: 'send_summary', label: 'Send summary', icon: 'mail' },
     { id: 'recognize', label: 'Recognize', icon: 'star' },
     { id: 'flag_hr', label: 'Flag for HR', icon: 'alert-triangle' }
   ];

   export function ActionMenu({ managerName, onAction }) {
     const [isOpen, setIsOpen] = useState(false);
     const menuRef = useRef(null);

     // Close on outside click
     useEffect(() => {
       function handleClickOutside(event) {
         if (menuRef.current && !menuRef.current.contains(event.target)) {
           setIsOpen(false);
         }
       }
       document.addEventListener('mousedown', handleClickOutside);
       return () => document.removeEventListener('mousedown', handleClickOutside);
     }, []);

     const handleAction = (action) => {
       // MVP: Log action, show alert
       console.log(`Action: ${action.id} for ${managerName}`);
       alert(`${action.label} for ${managerName}\n\n(Action integration coming in future phase)`);

       if (onAction) {
         onAction(action);
       }
       setIsOpen(false);
     };

     return (
       <div ref={menuRef} className="relative">
         <button
           onClick={() => setIsOpen(!isOpen)}
           className="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2"
         >
           Actions
           <svg
             className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`}
             fill="none"
             viewBox="0 0 24 24"
             stroke="currentColor"
           >
             <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
           </svg>
         </button>

         {isOpen && (
           <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-border py-1 z-50">
             {defaultActions.map((action) => (
               <button
                 key={action.id}
                 onClick={() => handleAction(action)}
                 className="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 focus:bg-gray-50 focus:outline-none"
               >
                 {action.label}
               </button>
             ))}
           </div>
         )}
       </div>
     );
   }
   ```

3. **ActionMenu/index.js:**
   ```jsx
   export { ActionMenu } from './ActionMenu';
   ```

4. **menus/index.js (barrel):**
   ```jsx
   export { ActionMenu } from './ActionMenu';
   ```
  </action>
  <verify>
Files exist at correct paths. Run `npm run build` - no errors.
  </verify>
  <done>ActionMenu component created with 4 actions, outside click handling, mocked handlers</done>
</task>

<task type="auto">
  <name>Task 2: Add Sources Footer and ActionMenu to ManagerDetail</name>
  <files>src/pages/ManagerDetail/ManagerDetail.jsx</files>
  <action>
Integrate ActionMenu in hero and add Sources footer:

1. **Add import:**
   ```jsx
   import { ActionMenu } from '@/components/menus';
   ```

2. **Add ActionMenu to hero section** - in the row with manager name and TimeframeToggle:
   Update the name/toggle row to include ActionMenu:
   ```jsx
   {/* Title row with TimeframeToggle and ActionMenu */}
   <div className="flex items-start justify-between mt-4">
     <div>
       <h1 className="text-3xl font-bold tracking-tight">{manager.name}</h1>
       <p className="text-gray-500">{manager.region} Region</p>
     </div>
     <div className="flex items-center gap-3">
       <TimeframeToggle />
       <ActionMenu managerName={manager.name} />
     </div>
   </div>
   ```

3. **Replace Sources placeholder** with actual footer after AE table:
   ```jsx
   {/* Sources Footer */}
   <div className="mt-8 pt-6 border-t border-border">
     <h4 className="text-sm font-semibold text-gray-700 mb-3">Sources</h4>
     <div className="flex flex-wrap gap-x-6 gap-y-2 text-sm text-gray-500">
       <span>{manager.sources.call_listening} calls listened</span>
       <span>{manager.sources.call_attendance} calls attended</span>
       <span>{manager.sources.call_comments} comments</span>
       <span>{manager.sources.scorecards} scorecards</span>
       <span>{manager.sources.feedback_events} feedback events</span>
     </div>
   </div>
   ```

4. **Remove all placeholder divs** - the page should now be complete.
  </action>
  <verify>
Run dev server. Navigate to /manager/MGR001:
- ActionMenu button appears next to TimeframeToggle
- Click "Actions" - dropdown shows 4 options
- Click "Add to 1:1" - alert appears confirming action
- Click outside dropdown - it closes
- Sources footer shows: "171 calls listened", "18 calls attended", "156 comments", "42 scorecards", "112 feedback events"

Navigate to /manager/MGR004:
- Sources footer shows lower numbers matching David's minimal engagement
  </verify>
  <done>ActionMenu and Sources footer integrated, completing the detail page layout</done>
</task>

</tasks>

<verification>
After both tasks:
1. `npm run build` passes without errors
2. ActionMenu barrel export works: `import { ActionMenu } from '@/components/menus'`
3. Actions dropdown opens/closes correctly
4. Clicking action shows alert with manager name
5. Sources footer shows correct counts per manager
6. No placeholder divs remain in ManagerDetail
</verification>

<success_criteria>
- DETAIL-10: Sources footer shows all 5 source counts
- ACT-02: Actions dropdown shows Add to 1:1, Send summary, Recognize, Flag for HR
</success_criteria>

<output>
After completion, create `.planning/phases/04-manager-detail/04-04-SUMMARY.md`
</output>
