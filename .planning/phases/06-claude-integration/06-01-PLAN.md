---
phase: 06-claude-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/stores/settingsStore.js
  - src/stores/chatStore.js
  - src/stores/index.js
  - src/lib/claude.js
autonomous: true

must_haves:
  truths:
    - "Anthropic SDK is installed and importable"
    - "Settings store persists API key to localStorage"
    - "Chat store manages messages, streaming state, and suggestions"
    - "Claude client factory creates browser-enabled client"
  artifacts:
    - path: "src/stores/settingsStore.js"
      provides: "API key storage with localStorage persistence"
      exports: ["useSettingsStore"]
    - path: "src/stores/chatStore.js"
      provides: "Conversation state management"
      exports: ["useChatStore"]
    - path: "src/lib/claude.js"
      provides: "Anthropic client factory and system prompt"
      exports: ["createClaudeClient", "SYSTEM_PROMPT"]
  key_links:
    - from: "src/stores/settingsStore.js"
      to: "localStorage"
      via: "zustand persist middleware"
      pattern: "persist.*localStorage"
    - from: "src/lib/claude.js"
      to: "@anthropic-ai/sdk"
      via: "import"
      pattern: "import.*Anthropic.*from.*@anthropic-ai/sdk"
---

<objective>
Install Anthropic SDK and create foundation stores for chat functionality: settingsStore for API key persistence and chatStore for conversation state management.

Purpose: Establish data layer and Claude client factory before building chat UI components.
Output: Working stores and client factory ready for useChat hook in Plan 02.
</objective>

<execution_context>
@/Users/ericgreene/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ericgreene/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-claude-integration/06-RESEARCH.md
@src/stores/timeframeStore.js
@src/stores/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Anthropic SDK</name>
  <files>package.json</files>
  <action>
    Install the official Anthropic TypeScript SDK:

    ```bash
    npm install @anthropic-ai/sdk
    ```

    This enables browser-to-API communication with the `dangerouslyAllowBrowser` flag.
  </action>
  <verify>
    - `grep "@anthropic-ai/sdk" package.json` shows the dependency
    - `ls node_modules/@anthropic-ai/sdk` confirms installation
  </verify>
  <done>
    @anthropic-ai/sdk is installed and available for import.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create settings and chat stores</name>
  <files>
    src/stores/settingsStore.js
    src/stores/chatStore.js
    src/stores/index.js
  </files>
  <action>
    1. Create src/stores/settingsStore.js with Zustand persist middleware:
       - State: apiKey (string | null)
       - Actions: setApiKey(key), clearApiKey()
       - Persist to localStorage with name 'coaching-settings'
       - Use createJSONStorage(() => localStorage)

    2. Create src/stores/chatStore.js:
       - State:
         - messages: [] (array of { id, role: 'user'|'assistant', content, timestamp })
         - streamingContent: '' (current streaming text)
         - status: 'idle' | 'loading' | 'streaming' | 'error'
         - error: null | string
         - suggestions: [] (follow-up suggestions)
       - Actions:
         - addUserMessage(content): adds user message, sets status to 'loading', returns message
         - startStreaming(): sets status to 'streaming', clears streamingContent
         - appendStreamingContent(text): appends text to streamingContent (use functional update)
         - completeStreaming(suggestions = []): creates assistant message from streamingContent, adds to messages, sets suggestions, resets status to 'idle'
         - setError(error): sets status to 'error', stores error.message
         - clearConversation(): resets all state to initial values

    3. Update src/stores/index.js to export useSettingsStore and useChatStore

    Follow the exact patterns from 06-RESEARCH.md Pattern 1 and Pattern 3.
    Use crypto.randomUUID() for message IDs.
  </action>
  <verify>
    - `grep -l "persist" src/stores/settingsStore.js` shows persist middleware
    - `grep "useSettingsStore" src/stores/index.js` shows export
    - `grep "useChatStore" src/stores/index.js` shows export
    - `grep "appendStreamingContent" src/stores/chatStore.js` shows streaming action
  </verify>
  <done>
    settingsStore persists API key to localStorage, chatStore manages full conversation lifecycle with streaming support.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Claude client factory and system prompt</name>
  <files>src/lib/claude.js</files>
  <action>
    1. Create src/lib directory if it doesn't exist

    2. Create src/lib/claude.js with:
       - Import Anthropic from '@anthropic-ai/sdk'
       - Export createClaudeClient(apiKey) function:
         - Throws Error if !apiKey
         - Returns new Anthropic({ apiKey, dangerouslyAllowBrowser: true })
       - Export SYSTEM_PROMPT constant with coaching analyst persona:
         - Identify as AI coaching analyst for sales VP Ann
         - Instruct to cite evidence using [-> CALL-XXXX] format
         - Instruct to provide actionable insights
         - Instruct to end with 2-3 follow-up questions
         - Format follow-ups as "Follow-up questions:" with bullet list

    Reference the system prompt example from 06-RESEARCH.md Code Examples section.
  </action>
  <verify>
    - `ls src/lib/claude.js` confirms file exists
    - `grep "dangerouslyAllowBrowser" src/lib/claude.js` shows browser flag
    - `grep "CALL-XXXX" src/lib/claude.js` shows citation instruction in prompt
    - `grep "Follow-up questions" src/lib/claude.js` shows suggestion format instruction
  </verify>
  <done>
    Claude client factory creates browser-enabled Anthropic client, system prompt instructs citation format and follow-up suggestions.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run build` succeeds with no errors
2. `npm run dev` starts and app loads without console errors
3. All stores export correctly from @/stores
4. Foundation is ready for useChat hook in Plan 02
</verification>

<success_criteria>
- @anthropic-ai/sdk installed and in package.json
- settingsStore exports useSettingsStore with persist middleware
- chatStore exports useChatStore with full conversation state management
- src/lib/claude.js exports createClaudeClient and SYSTEM_PROMPT
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-claude-integration/06-01-SUMMARY.md`
</output>
